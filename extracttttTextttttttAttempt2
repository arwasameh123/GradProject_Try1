import cv2
import pytesseract
from pdf2image import convert_from_path

# ---- Tesseract setup (for macOS via Homebrew) ----
pytesseract.pytesseract.tesseract_cmd = "/opt/homebrew/bin/tesseract"
config = r'--tessdata-dir "/opt/homebrew/share/tessdata" -l ara --oem 1 --psm 6'

# ---- PDF path ----
pages = convert_from_path("/Users/amorayasser/Downloads/edited.pdf")

# ---- OCR extraction ----
text = ""
for page in pages:
    page.save("temp.png", "PNG")
    img = cv2.imread("temp.png")

    # Convert to grayscale + enhance contrast
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    gray = cv2.bilateralFilter(gray, 9, 75, 75)
    gray = cv2.threshold(gray, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)[1]

    # Arabic OCR
    text += pytesseract.image_to_string(gray, config=config) + "\n"

# ---- Save output ----
with open("output_clean.txt", "w", encoding="utf-8") as f:
    f.write(text)

print("âœ… OCR complete! Saved as output_clean.txt")
