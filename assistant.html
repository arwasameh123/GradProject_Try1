<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="logo.jpeg" />
  <title>TaxGPT — مصلحة الضرائب</title>
  <link rel="icon" href="https://eta.gov.eg/sites/default/files/favicon.ico" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Cairo", sans-serif;
      background: #f9fbff;
      color: #003366;
    }
    .navbar {
      background-color: #003366;
    }
    .navbar-brand img {
      height: 55px;
    }
    .navbar-nav .nav-link {
      color: #fff !important;
      font-weight: 500;
    }
    .navbar-nav .nav-link:hover {
      color: #ffcc00 !important;
    }
    .assistant-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 80vh;
      padding: 40px 0;
    }
    .card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 450px;
      padding: 2rem;
      text-align: center;
    }
    input, textarea, button {
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-family: "Cairo", sans-serif;
    }
    input, textarea {
      background: rgba(0,0,0,0.05);
    }
    button {
      background: #ffcc00;
      color: #003366;
      font-weight: bold;
      cursor: pointer;
    }
    .chat-box {
      background: rgba(0,0,0,0.05);
      border-radius: 10px;
      padding: 10px;
      text-align: right;
      height: 300px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .message {
      margin: 5px 0;
      padding: 8px 12px;
      border-radius: 8px;
      max-width: 90%;
      line-height: 1.4;
    }
    .user {
      background: #ffcc00;
      color: #003366;
    }
    .bot {
      background: rgba(0,0,0,0.1);
    }
    footer {
      background: #002244;
      color: #d1d5db;
      padding: 20px 0;
      text-align: center;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="index.html">
        <img src="logo.jpeg" alt="شعار مصلحة الضرائب المصرية" />

      </a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a href="index.html" class="nav-link">الرئيسية</a></li>
          <li class="nav-item"><a href="#" class="nav-link">الخدمات الإلكترونية</a></li>
          <li class="nav-item"><a href="#" class="nav-link">القوانين والتعليمات</a></li>
          <li class="nav-item"><a href="#" class="nav-link">مركز إعلامي</a></li>
          <li class="nav-item"><a href="#" class="nav-link">التسهيلات الضريبية</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <section class="assistant-container">
    <div id="loginPage" class="card">
      <h3>تسجيل الدخول</h3>
      <input type="email" id="email" placeholder="البريد الإلكتروني" />
      <input type="password" id="password" placeholder="كلمة المرور" />
      <button id="loginBtn">دخول</button>
    </div>

    <div id="chatPage" class="card" style="display:none;">
      <h3>TaxGPT</h3>
      <div id="chatBox" class="chat-box"></div>
      <textarea id="userInput" placeholder="اكتب سؤالك هنا..." rows="1"></textarea>
      <input type="file" id="fileInput" accept=".pdf,.docx,.txt" style="display:none;" />
      <div style="display:flex; gap:10px;">
        <button id="sendBtn">إرسال</button>
        <button id="uploadBtn">📁 رفع ملف</button>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <p>© 2025 مصلحة الضرائب المصرية — جميع الحقوق محفوظة</p>
    </div>
  </footer>

  <script>
    const loginPage = document.getElementById("loginPage");
    const chatPage = document.getElementById("chatPage");
    const loginBtn = document.getElementById("loginBtn");
    const chatBox = document.getElementById("chatBox");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");

    loginBtn.onclick = () => {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      if ((email === "admin@example.com" && password === "1234") || (email === "user@eta.gov.eg" && password === "5678")) {
        loginPage.style.display = "none";
        chatPage.style.display = "block";
        chatBox.innerHTML = `<div class='message bot'>مرحبًا ${email.split('@')[0]} 👋! كيف يمكنني مساعدتك اليوم؟</div>`;
      } else {
        alert("❌ البريد الإلكتروني أو كلمة المرور غير صحيحة");
      }
    };

    sendBtn.onclick = sendMessage;
    userInput.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      addMessage(text, "user");
      userInput.value = "";
      let reply = "";
      if (text.includes("ضريبة")) reply = "💰 الضريبة هي مورد أساسي لميزانية الدولة.";
      else if (text.includes("تسجيل")) reply = "🔑 يمكنك التسجيل عبر بوابة الممول على موقع المصلحة.";
      else reply = "🤖 جاري تطوير قاعدة المعرفة للإجابة على سؤالك.";
      setTimeout(() => addMessage(reply, "bot"), 1000);
    }

    // ✅ رفع ملف وتحليل محتواه
uploadBtn.onclick = () => fileInput.click();


fileInput.onchange = async (e) => {
  const file = e.target.files[0];
  if (!file) return;
  addMessage(`📤 تم رفع الملف: ${file.name}`, "user");

  const formData = new FormData();
  formData.append("file", file);

  addMessage("⏳ جاري تحليل الملف، من فضلك انتظر...", "bot");

  const res = await fetch("http://127.0.0.1:5000/upload", {
    method: "POST",
    body: formData
  });
  const data = await res.json();

  if (data.error) {
    addMessage("❌ حدث خطأ أثناء رفع الملف.", "bot");
  } else {
    addMessage(data.message, "bot");
    addMessage(`📄 نص مستخرج:\n${data.preview}`, "bot");
  }
};
// === Helper function to show messages in the chat ===
function addMessage(text, sender = "bot") {
  const chatBox = document.getElementById("chatBox");
  const msg = document.createElement("div");
  msg.classList.add("message", sender);
  msg.textContent = text;
  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

  </script>
</body>
</html>
